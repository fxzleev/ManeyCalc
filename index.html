<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –ö–∞—Å—Å—ã Pro</title>
    <link rel="manifest" href="./manifest.json">
    <style>
        :root {
            --bg: #f4f7f6;
            --card: #ffffff;
            --text: #2c3e50;
            --primary: #3498db;
            --accent: #27ae60;
            --border: #ddd;
        }

        [data-theme="dark"] {
            --bg: #1a1a1a;
            --card: #2d2d2d;
            --text: #e0e0e0;
            --primary: #3498db;
            --accent: #2ecc71;
            --border: #444;
        }

        body {
            font-family: -apple-system, system-ui, sans-serif;
            background-color: var(--bg);
            color: var(--text);
            margin: 0;
            padding: 10px;
            transition: all 0.3s ease;
        }

        .container {
            max-width: 500px;
            margin: 0 auto;
            background: var(--card);
            padding: 15px;
            border-radius: 20px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .total-banner {
            background: var(--primary);
            color: white;
            padding: 15px;
            border-radius: 15px;
            text-align: center;
            position: sticky;
            top: 10px;
            z-index: 100;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
        }

        .total-amount {
            font-size: 1.8rem;
            font-weight: 800;
        }

        .row {
            display: flex;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid var(--border);
        }

        .label {
            flex: 1;
            font-weight: bold;
            font-size: 1.1rem;
        }

        .controls {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        button.step {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            border: none;
            background: var(--primary);
            color: white;
            font-weight: bold;
            font-size: 1.2rem;
            cursor: pointer;
        }

        input {
            width: 55px;
            height: 40px;
            text-align: center;
            border: 2px solid var(--border);
            border-radius: 8px;
            background: var(--bg);
            color: var(--text);
            font-weight: bold;
            font-size: 1rem;
        }

        .subtotal {
            width: 90px;
            text-align: right;
            font-family: monospace;
            font-size: 0.9rem;
            color: var(--accent);
        }

        .section-title {
            padding: 15px 0 5px;
            font-size: 0.8rem;
            text-transform: uppercase;
            color: #888;
            font-weight: bold;
        }

        .theme-toggle {
            background: none;
            border: 1px solid var(--border);
            color: var(--text);
            padding: 8px 15px;
            border-radius: 20px;
            cursor: pointer;
        }

        .actions {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 20px;
        }

        .btn {
            padding: 15px;
            border: none;
            border-radius: 12px;
            font-weight: bold;
            color: white;
            cursor: pointer;
            font-size: 1rem;
        }

        .btn-save {
            background: var(--accent);
        }

        .btn-reset {
            background: #e74c3c;
        }

        .history-box {
            margin-top: 30px;
            border-top: 2px solid var(--border);
            padding-top: 20px;
        }

        .history-item {
            background: var(--bg);
            padding: 12px;
            border-radius: 12px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-left: 4px solid var(--accent);
        }

        .history-info {
            display: flex;
            flex-direction: column;
        }

        .history-date {
            font-size: 0.8rem;
            color: #888;
            margin-bottom: 2px;
        }

        .history-val {
            font-weight: 800;
            font-size: 1.1rem;
        }

        .btn-del {
            background: none;
            border: none;
            color: #e74c3c;
            font-size: 1.3rem;
            cursor: pointer;
            padding: 5px;
        }
    </style>
</head>

<body data-theme="light">

    <div class="container">
        <div class="header">
            <span style="font-weight: bold; font-size: 1.2rem;">–î–µ–Ω–µ–∂–Ω—ã–π —Å—á–µ—Ç</span>
            <button class="theme-toggle" onclick="toggleTheme()">üåì –¢–µ–º–∞</button>
        </div>

        <div class="total-banner">
            <div style="font-size: 0.8rem; opacity: 0.9; letter-spacing: 1px;">–ò–¢–û–ì–û –í –ö–ê–°–°–ï</div>
            <div class="total-amount" id="grandTotal">0,00 ‚ÇΩ</div>
        </div>

        <div id="cash-list"></div>

        <div class="actions">
            <button class="btn btn-save" onclick="saveToHistory()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
            <button class="btn btn-reset" onclick="resetAll()">‚ùå –û—á–∏—Å—Ç–∏—Ç—å</button>
        </div>

        <div class="history-box">
            <div class="section-title">–ò—Å—Ç–æ—Ä–∏—è –∑–∞–ø–∏—Å–µ–π</div>
            <div id="history-list"></div>
        </div>
    </div>

    <script>
        const denominations = [
            { val: 5000, type: 'note' }, { val: 2000, type: 'note' }, { val: 1000, type: 'note' },
            { val: 500, type: 'note' }, { val: 200, type: 'note' }, { val: 100, type: 'note' },
            { val: 50, type: 'note' }, { val: 10, type: 'note' }, { val: 5, type: 'note' },
            { val: 10, type: 'coin', label: '10 ‚ÇΩ (–º–æ–Ω–µ—Ç–∞)' }, { val: 5, type: 'coin', label: '5 ‚ÇΩ (–º–æ–Ω–µ—Ç–∞)' },
            { val: 2, type: 'coin', label: '2 ‚ÇΩ (–º–æ–Ω–µ—Ç–∞)' }, { val: 1, type: 'coin', label: '1 ‚ÇΩ (–º–æ–Ω–µ—Ç–∞)' },
            { val: 0.5, type: 'coin', label: '50 –∫–æ–ø.' }, { val: 0.1, type: 'coin', label: '10 –∫–æ–ø.' }
        ];

        let currentTotal = 0;

        function render() {
            const container = document.getElementById('cash-list');
            container.innerHTML = '<div class="section-title">–ö—É–ø—é—Ä—ã</div>';
            let coinAdded = false;

            denominations.forEach((item, i) => {
                if (item.type === 'coin' && !coinAdded) {
                    container.innerHTML += '<div class="section-title">–ú–æ–Ω–µ—Ç—ã</div>';
                    coinAdded = true;
                }
                const row = document.createElement('div');
                row.className = 'row';
                row.innerHTML = `
                <div class="label">${item.label || item.val + ' ‚ÇΩ'}</div>
                <div class="controls">
                    <button class="step" onclick="change(${i}, -1)">-</button>
                    <input type="number" id="in-${i}" oninput="calculate()" inputmode="numeric">
                    <button class="step" onclick="change(${i}, 1)">+</button>
                </div>
                <div class="subtotal" id="sub-${i}">0</div>`;
                container.appendChild(row);
            });
            loadHistory();
        }

        function change(i, delta) {
            const inp = document.getElementById(`in-${i}`);
            let v = parseInt(inp.value) || 0;
            v = Math.max(0, v + delta);
            inp.value = v === 0 ? '' : v;
            calculate();
        }

        function calculate() {
            currentTotal = 0;
            denominations.forEach((item, i) => {
                const qty = parseFloat(document.getElementById(`in-${i}`).value) || 0;
                const sub = qty * item.val;
                currentTotal += sub;
                document.getElementById(`sub-${i}`).innerText = sub > 0 ? sub.toLocaleString() : '0';
            });
            document.getElementById('grandTotal').innerText = currentTotal.toLocaleString('ru-RU', { minimumFractionDigits: 2 }) + ' ‚ÇΩ';
        }

        function saveToHistory() {
            if (currentTotal === 0) return alert('–°–Ω–∞—á–∞–ª–∞ –≤–≤–µ–¥–∏—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–µ–Ω–µ–≥');

            const history = JSON.parse(localStorage.getItem('cash_history') || '[]');

            // –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –¥–∞—Ç—É: "31 —è–Ω–≤., 17:25"
            const now = new Date();
            const dateStr = now.toLocaleString('ru-RU', {
                day: '2-digit',
                month: 'short',
                hour: '2-digit',
                minute: '2-digit'
            });

            const record = {
                id: Date.now(),
                date: dateStr,
                amount: currentTotal
            };

            history.unshift(record);
            localStorage.setItem('cash_history', JSON.stringify(history));
            loadHistory();

            if (confirm('–ó–∞–ø–∏—Å—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞! –û—á–∏—Å—Ç–∏—Ç—å —Ç–∞–±–ª–∏—Ü—É –¥–ª—è –Ω–æ–≤–æ–≥–æ —Å—á–µ—Ç–∞?')) {
                resetAll(false);
            }
        }

        function loadHistory() {
            const list = document.getElementById('history-list');
            const history = JSON.parse(localStorage.getItem('cash_history') || '[]');

            if (history.length === 0) {
                list.innerHTML = '<div style="color:#888; text-align:center; padding: 20px;">–ò—Å—Ç–æ—Ä–∏—è –ø—É—Å—Ç–∞</div>';
                return;
            }

            list.innerHTML = '';
            history.forEach(item => {
                const row = document.createElement('div');
                row.className = 'history-item';
                row.innerHTML = `
                <div class="history-info">
                    <span class="history-date">${item.date}</span>
                    <span class="history-val">${item.amount.toLocaleString('ru-RU', { minimumFractionDigits: 2 })} ‚ÇΩ</span>
                </div>
                <button class="btn-del" onclick="deleteHistory(${item.id})">üóëÔ∏è</button>
            `;
                list.appendChild(row);
            });
        }

        function deleteHistory(id) {
            if (!confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç—É –∑–∞–ø–∏—Å—å –∏–∑ –∏—Å—Ç–æ—Ä–∏–∏?')) return;
            let history = JSON.parse(localStorage.getItem('cash_history') || '[]');
            history = history.filter(item => item.id !== id);
            localStorage.setItem('cash_history', JSON.stringify(history));
            loadHistory();
        }

        function toggleTheme() {
            const theme = document.body.getAttribute('data-theme') === 'dark' ? 'light' : 'dark';
            document.body.setAttribute('data-theme', theme);
            localStorage.setItem('theme', theme);
        }

        function resetAll(confirmAction = true) {
            if (confirmAction && !confirm('–û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ –ø–æ–ª—è –≤–≤–æ–¥–∞?')) return;
            document.querySelectorAll('input').forEach(i => i.value = '');
            calculate();
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ç–µ–º—ã –∏ –æ—Ç—Ä–∏—Å–æ–≤–∫–∞
        if (localStorage.getItem('theme') === 'dark') document.body.setAttribute('data-theme', 'dark');
        render();
    </script>
</body>

</html>